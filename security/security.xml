<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record model="ir.module.category" id="module_category_bureaucratic_knowledge">
        <field name="name">Bureaucratic Knowledge</field>
        <field name="sequence">100</field>
        <field name="visible" eval="1" />
    </record>

    <record id="group_bureaucratic_knowledge_user_implicit" model="res.groups">
        <field name="name">Bureaucratic Knowledge / User (implicit)</field>
        <field name="category_id" ref="bureaucrat_knowledge.module_category_bureaucratic_knowledge"/>
        <field name="comment">
            User (implicit) has readonly access to knowledge base, has no access to Knowledge menu.
            This access right have to be used for cases, when user have to be able to read knowledgebase documents
            from related objects, but does not have to have access to Knowledgebase.
        </field>
    </record>

    <record id="group_bureaucratic_knowledge_user" model="res.groups">
        <field name="name">Bureaucratic Knowledge / User</field>
        <field name="implied_ids"
               eval="[
               (4, ref('bureaucrat_knowledge.group_bureaucratic_knowledge_user_implicit')),
               (4, ref('base.group_user'))]"/>
        <field name="category_id" ref="bureaucrat_knowledge.module_category_bureaucratic_knowledge"/>
        <field name="comment">
            Usual user of knowledge base with readonly access.
        </field>
    </record>

    <record id="group_bureaucratic_knowledge_manager" model="res.groups">
        <field name="name">Bureaucratic Knowledge / Manager</field>
        <field name="implied_ids" eval="[(4, ref('bureaucrat_knowledge.group_bureaucratic_knowledge_user'))]"/>
        <field name="category_id" ref="bureaucrat_knowledge.module_category_bureaucratic_knowledge"/>
        <field name="users" eval="[(4, ref('base.user_root'))]"/>
        <field name="comment">
            Manager of knowledge base. Users in this group have full access to knowledgebase.
        </field>
    </record>

    <!-- Access rights for knowlege base implicit user
         - write/create/unlink access rights are allowed by ir.model.access.csv
         - and restricted in these rules
    -->
    <record id="rule_bureaucrat_knowledge_category_readers" model="ir.rule">
        <field name="name">knowledge categories by readers</field>
        <field name="model_id" ref="bureaucrat_knowledge.model_bureaucrat_knowledge_category"/>
        <field name="domain_force">[('visibility_user_ids', 'child_of', user.id)]</field>
        <field name="groups" eval="[(4, ref('bureaucrat_knowledge.group_bureaucratic_knowledge_user_implicit'))]"/>
        <field eval="0" name="perm_unlink"/>
        <field eval="0" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>

    <record id="rule_bureaucrat_knowledge_category_editors" model="ir.rule">
        <field name="name">knowledge categories by editors</field>
        <field name="model_id" ref="bureaucrat_knowledge.model_bureaucrat_knowledge_category"/>
        <field name="domain_force">[('editor_user_ids', 'child_of', user.id)]</field>
        <field name="groups" eval="[(4, ref('bureaucrat_knowledge.group_bureaucratic_knowledge_user_implicit'))]"/>
        <field eval="0" name="perm_unlink"/>
        <field eval="1" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>
 
    <record id="rule_bureaucrat_knowledge_category_owners" model="ir.rule">
        <field name="name">knowledge categories by owners</field>
        <field name="model_id" ref="bureaucrat_knowledge.model_bureaucrat_knowledge_category"/>
        <field name="domain_force">[('owner_user_ids', 'child_of', user.id)]</field>
        <field name="groups" eval="[(4, ref('bureaucrat_knowledge.group_bureaucratic_knowledge_user_implicit'))]"/>
        <field eval="1" name="perm_unlink"/>
        <field eval="1" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="1" name="perm_create"/>
    </record>

    <record id="rule_bureaucrat_knowledge_category_group_visibility" model="ir.rule">
        <field name="name">knowledge categories by group readers</field>
        <field name="model_id" ref="bureaucrat_knowledge.model_bureaucrat_knowledge_category"/>
        <field name="domain_force">[('visibility_group_ids', 'in', user.groups_id.ids)]</field>
        <field name="groups" eval="[(4, ref('bureaucrat_knowledge.group_bureaucratic_knowledge_user_implicit'))]"/>
        <field eval="0" name="perm_unlink"/>
        <field eval="0" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>

    <record id="rule_bureaucrat_knowledge_category_group_editors" model="ir.rule">
        <field name="name">knowledge categories by group editors</field>
        <field name="model_id" ref="bureaucrat_knowledge.model_bureaucrat_knowledge_category"/>
        <field name="domain_force">[('editor_group_ids', 'in', user.groups_id.ids)]</field>
        <field name="groups" eval="[(4, ref('bureaucrat_knowledge.group_bureaucratic_knowledge_user_implicit'))]"/>
        <field eval="0" name="perm_unlink"/>
        <field eval="1" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>

    <record id="rule_bureaucrat_knowledge_category_group_owners" model="ir.rule">
        <field name="name">knowledge categories by group owners</field>
        <field name="model_id" ref="bureaucrat_knowledge.model_bureaucrat_knowledge_category"/>
        <field name="domain_force">[('owner_group_ids', 'in', user.groups_id.ids)]</field>
        <field name="groups" eval="[(4, ref('bureaucrat_knowledge.group_bureaucratic_knowledge_user_implicit'))]"/>
        <field eval="1" name="perm_unlink"/>
        <field eval="1" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="1" name="perm_create"/>
    </record>

    <record id="rule_bureaucrat_knowledge_category_visibility_subscribers" model="ir.rule">
        <field name="name">knowledge categories by subscribers</field>
        <field name="model_id" ref="bureaucrat_knowledge.model_bureaucrat_knowledge_category"/>
        <field name="domain_force">[
            '&amp;',
            ('message_follower_ids.partner_id', 'child_of', user.partner_id.id),
            ('visibility_type', '=', 'subscribers')]</field>
        <field name="groups" eval="[(4, ref('bureaucrat_knowledge.group_bureaucratic_knowledge_user_implicit'))]"/>
        <field eval="0" name="perm_unlink"/>
        <field eval="0" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>

    <record id="rule_bureaucrat_knowledge_category_group_public" model="ir.rule">
        <field name="name">knowledge categories by group public</field>
        <field name="model_id" ref="bureaucrat_knowledge.model_bureaucrat_knowledge_category"/>
        <field name="domain_force">[('visibility_type', '=', 'public')]</field>
        <field name="groups" eval="[(4, ref('base.group_public'))]"/>
        <field eval="0" name="perm_unlink"/>
        <field eval="0" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>

    <record id="rule_bureaucrat_knowledge_category_group_public_subscribers" model="ir.rule">
        <field name="name">knowledge categories by group public</field>
        <field name="model_id" ref="bureaucrat_knowledge.model_bureaucrat_knowledge_category"/>
        <field name="domain_force">[
            '&amp;',
            ('visibility_type', '=', 'public'),
            ('message_follower_ids.partner_id', 'child_of', user.partner_id.id)]</field>
        <field name="groups" eval="[(4, ref('base.group_public'))]"/>
        <field eval="0" name="perm_unlink"/>
        <field eval="0" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>

    <record id="rule_bureaucrat_knowledge_category_group_portal" model="ir.rule">
        <field name="name">knowledge categories by group portal</field>
        <field name="model_id" ref="bureaucrat_knowledge.model_bureaucrat_knowledge_category"/>
        <field name="domain_force">[('visibility_type', '=', 'portal')]</field>
        <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        <field eval="0" name="perm_unlink"/>
        <field eval="0" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>

    <record id="rule_bureaucrat_knowledge_category_group_portal_subscribers" model="ir.rule">
        <field name="name">knowledge categories by group portal</field>
        <field name="model_id" ref="bureaucrat_knowledge.model_bureaucrat_knowledge_category"/>
        <field name="domain_force">[
            '&amp;',
            ('visibility_type', '=', 'portal'),
            ('message_follower_ids.partner_id', 'child_of', user.partner_id.id),]</field>
        <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        <field eval="0" name="perm_unlink"/>
        <field eval="0" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>

    <record id="rule_bureaucrat_knowledge_category_group_user" model="ir.rule">
        <field name="name">knowledge categories by group internal</field>
        <field name="model_id" ref="bureaucrat_knowledge.model_bureaucrat_knowledge_category"/>
        <field name="domain_force">[('visibility_type', '=', 'internal')]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field eval="0" name="perm_unlink"/>
        <field eval="0" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>

    <record id="rule_bureaucrat_knowledge_category_group_user_subscribers" model="ir.rule">
        <field name="name">knowledge categories by group internal</field>
        <field name="model_id" ref="bureaucrat_knowledge.model_bureaucrat_knowledge_category"/>
        <field name="domain_force">[
            '&amp;',
            ('visibility_type', '=', 'internal'),
            ('message_follower_ids.partner_id', 'child_of', user.partner_id.id)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field eval="0" name="perm_unlink"/>
        <field eval="0" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>

    <record id="rule_bureaucrat_knowledge_category_visibility_restrirced_for_users" model="ir.rule">
        <field name="name">knowledge categories by restricted</field>
        <field name="model_id" ref="bureaucrat_knowledge.model_bureaucrat_knowledge_category"/>
        <field name="domain_force">[
            '&amp;',
            ('visibility_user_ids', 'child_of', user.id),
            ('visibility_type', '=', 'restricted')]</field>
        <field name="groups" eval="[(4, ref('bureaucrat_knowledge.group_bureaucratic_knowledge_user_implicit'))]"/>
        <field eval="0" name="perm_unlink"/>
        <field eval="0" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>

    <record id="rule_bureaucrat_knowledge_category_visibility_restrirced_for_group" model="ir.rule">
        <field name="name">knowledge categories by restricted</field>
        <field name="model_id" ref="bureaucrat_knowledge.model_bureaucrat_knowledge_category"/>
        <field name="domain_force">[
            '&amp;',
            ('visibility_group_ids', 'in', user.groups_id.ids),
            ('visibility_type', '=', 'restricted')]</field>
        <field name="groups" eval="[(4, ref('bureaucrat_knowledge.group_bureaucratic_knowledge_user_implicit'))]"/>
        <field eval="0" name="perm_unlink"/>
        <field eval="0" name="perm_write"/>
        <field eval="1" name="perm_read"/>
        <field eval="0" name="perm_create"/>
    </record>

</odoo>
